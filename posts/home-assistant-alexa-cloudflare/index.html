<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Home Assistant Alexa smart home integration over Cloudflare" /><meta property="og:locale" content="en" /><meta name="description" content="Today I decided it was the day that I was going to manage to get Alexa to talk to my Home Assistant (HA). There are a couple of things that made this slightly difficult for me. The first was that I had limited access to my domain only to the UK. The second was a setting I didn’t even know was on but after finding it I didn’t want to turn it off. Something that made it a little hard to track down was that the error message was being masked by an error that is commonly encountered during the setup process." /><meta property="og:description" content="Today I decided it was the day that I was going to manage to get Alexa to talk to my Home Assistant (HA). There are a couple of things that made this slightly difficult for me. The first was that I had limited access to my domain only to the UK. The second was a setting I didn’t even know was on but after finding it I didn’t want to turn it off. Something that made it a little hard to track down was that the error message was being masked by an error that is commonly encountered during the setup process." /><link rel="canonical" href="https://blog.allaway.tech/posts/home-assistant-alexa-cloudflare/" /><meta property="og:url" content="https://blog.allaway.tech/posts/home-assistant-alexa-cloudflare/" /><meta property="og:site_name" content="blog.allaway.tech" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-01T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Home Assistant Alexa smart home integration over Cloudflare" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-15T01:16:17+01:00","datePublished":"2022-07-01T00:00:00+01:00","description":"Today I decided it was the day that I was going to manage to get Alexa to talk to my Home Assistant (HA). There are a couple of things that made this slightly difficult for me. The first was that I had limited access to my domain only to the UK. The second was a setting I didn’t even know was on but after finding it I didn’t want to turn it off. Something that made it a little hard to track down was that the error message was being masked by an error that is commonly encountered during the setup process.","headline":"Home Assistant Alexa smart home integration over Cloudflare","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.allaway.tech/posts/home-assistant-alexa-cloudflare/"},"url":"https://blog.allaway.tech/posts/home-assistant-alexa-cloudflare/"}</script><title>Home Assistant Alexa smart home integration over Cloudflare | blog.allaway.tech</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="blog.allaway.tech"><meta name="application-name" content="blog.allaway.tech"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://media.allaway.tech/blogassets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">blog.allaway.tech</a></div><div class="site-subtitle font-italic">The musings and rabbit holes of a digital media tech.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/audio_diagrams/" class="nav-link"> <i class="fa-fw fas fa-volume-up ml-xl-3 mr-xl-3 unloaded"></i> <span>AUDIO DIAGRAMS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/harmanhobbit" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['blog','allaway.tech'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <a href="/">Home</a> / <a href="/posts/">Posts</a> / Home Assistant Alexa smart home integration over Cloudflare </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Home Assistant Alexa smart home integration over Cloudflare</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656630000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2022 </em> </span> <span> Updated <em class="" data-ts="1665792977" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 15, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/harmanhobbit">ian</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="993 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Today I decided it was the day that I was going to manage to get Alexa to talk to my Home Assistant (HA). There are a couple of things that made this slightly difficult for me. The first was that I had limited access to my domain only to the UK. The second was a setting I didn’t even know was on but after finding it I didn’t want to turn it off. Something that made it a little hard to track down was that the error message was being masked by an error that is commonly encountered during the setup process.</p><p><a href="https://media.allaway.tech/blog/media/posts/images/2022-07-01-cloudflare-hass/cfhasserror.jpg" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="https://media.allaway.tech/blog/media/posts/images/2022-07-01-cloudflare-hass/cfhasserror.jpg" alt="Cloudflare error returned to AWS Lambda" width="350" height="350" class="lazyload" data-proofer-ignore></a></p><h2 id="tldr"><span class="mr-2">TL;DR</span><a href="#tldr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are running your Home Assitant instance through Cloudflare and your Alexa cannot connect or successfully get an authentication token then check your Bot Fight setting and Web Application Firewall rules.</p><h2 id="the-back-story"><span class="mr-2">The Back Story</span><a href="#the-back-story" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When I first started self-hosting I was getting some random hits on my domains. For some reason, someone in Singapore seemed to think I was running a WordPress site on my domain and kept trying to hit the admin page. So just to be safe I decided to set up a WAF (although it was just called firewall rules back then) rule to only allow traffic in from the United Kingdom. This seemed like a sensible decision as I live in the UK and could always add a new rule if I was going to spend any amount of time in a foreign country.</p><h2 id="solving-the-first-problem---wrong-country"><span class="mr-2">Solving the first problem - Wrong country</span><a href="#solving-the-first-problem---wrong-country" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>From the photo above you can see that I was getting an INVALID_AUTHORIZATION_CREDENTIAL error. What I didn’t realize for a very long time is that the body of my error was different from the one that was in the video tutorial I was following. After realizing that I had a different error I straight away started to google it. What took me the longest was tracking down what was causing the 1020 error. Eventually, I realized that it was coming from Cloudflare and not from my Home Assistant server. Once I knew which logs I should be looking at it was much easier to track down the exact problem to fix it. It turns out that it was because of the decision I had taken a year ago that I explained above. To test my theory I added the county that I was using to run my AWS Lambda function into another rule and, hey presto, I was able to get a response back from my HA server.</p><p><a href="https://media.allaway.tech/blog/media/posts/images/2022-07-01-cloudflare-hass/lambda_success.png" class="popup img-link "><img data-src="https://media.allaway.tech/blog/media/posts/images/2022-07-01-cloudflare-hass/lambda_success.png" alt="AWS Lambda function returning a successful result from Home Assistant" class="lazyload" data-proofer-ignore></a></p><h2 id="solving-the-second-problem---bots"><span class="mr-2">Solving the second problem - Bots</span><a href="#solving-the-second-problem---bots" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The next problem was not quite so easy to track down. Once I had the Lambda function working I moved on to trying to get the authentication going. Knowing that it was probably my WAF that was going to be causing the problem gave me a head start on tracking the problem down. Watching the logs as I tried to sign in showed that several requests were being issued a JavaScript bot challenge. And as it was a bot trying to sign in it was of course failing to do so. A slightly secondary issue was that the bot seemed to be coming from the USA and not Ireland or the United Kingdom as I had been expecting. To start with I thought that adding another WAF rule to allow both the USA and Known Bots might be the solution. This didn’t work as expected. I’m not sure why but Cloudflare’s bot fight security setting seems to be the ultimate rule. There is no way to override it. The second problem is there are a lot of people and/or servers in the US that I didn’t particularly want to access my home automation. This meant I wanted to narrow down the scope of a WAF rule that might let traffic in. I finally settled on a rule that ensured that the country was the USA, the hostname being requested matched that of my public-facing HA subdomain and finally the URI path matched that it needed to get the correct authorization token. The final rule looked something like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>(ip.geoip.country eq "US"
and
http.host eq "&lt;subdomain&gt;.&lt;domain&gt;.&lt;tld&gt;"
and
http.request.uri.path eq "/auth/token")
</pre></table></code></div></div><blockquote class="prompt-warning"><p>N.B. This should be one continuous line but I have broken it up in an attempt to make it easier to read.</p></blockquote><p>This, after all of my previous WAF fun, surprisingly worked.</p><h2 id="combining-the-waf-rules"><span class="mr-2">Combining the WAF rules</span><a href="#combining-the-waf-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Unfortunately, I was now using 4 out of my 5 free WAF rules on my Cloudflare account so the next problem became combining the rules all into one. There seems to be a slight bug in the Cloudflare WAF rules that the following very simple block rule:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>(ip.geoip.country ne "GB") 

or 

(ip.geoip.country ne "IE")
</pre></table></code></div></div><blockquote class="prompt-warning"><p>N.B. This should be one continuous line but I have broken it up in an attempt to make it easier to read.</p></blockquote><p>Just blocks everything as GB is not IE and IE is not GB. Not the most useful. Luckily if you start building more complex rules this flaw doesn’t seem to hold up. That means we can use something like the following:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>(ip.geoip.country eq "IE"
and
http.host eq "&lt;subdomain&gt;.&lt;domain&gt;.&lt;tld&gt;"
and
http.request.uri.path eq "/api/alexa/smart_home")

or

(ip.geoip.country eq "US"
and
http.host eq "&lt;subdomain&gt;.&lt;domain&gt;.&lt;tld&gt;"
and
http.request.uri.path eq "/auth/token")

or

(ip.geoip.country eq "GB")
</pre></table></code></div></div><blockquote class="prompt-warning"><p>N.B. This should be one continuous line but I have broken it up in an attempt to make it easier to read.</p></blockquote><h2 id="summing-up"><span class="mr-2">Summing up</span><a href="#summing-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>So now I have one firewall rule that is controlling the access to my domain and whilst I would have liked to keep the Bot Fight setting turned on I think I have reduced the chance of getting unwanted hits. I hope that this may help someone else in the future as it took me a fair chunk of the day to finally work out why the tutorial was failing.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/home-assistant/'>Home Assistant</a>, <a href='/categories/cloudflare/'>Cloudflare</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hass/" class="post-tag no-text-decoration" >hass</a> <a href="/tags/homeassistant/" class="post-tag no-text-decoration" >homeassistant</a> <a href="/tags/cloudflare/" class="post-tag no-text-decoration" >cloudflare</a> <a href="/tags/firewall/" class="post-tag no-text-decoration" >firewall</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Home%20Assistant%20Alexa%20smart%20home%20integration%20over%20Cloudflare%20-%20blog.allaway.tech&url=https%3A%2F%2Fblog.allaway.tech%2Fposts%2Fhome-assistant-alexa-cloudflare%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Home%20Assistant%20Alexa%20smart%20home%20integration%20over%20Cloudflare%20-%20blog.allaway.tech&u=https%3A%2F%2Fblog.allaway.tech%2Fposts%2Fhome-assistant-alexa-cloudflare%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.allaway.tech%2Fposts%2Fhome-assistant-alexa-cloudflare%2F&text=Home%20Assistant%20Alexa%20smart%20home%20integration%20over%20Cloudflare%20-%20blog.allaway.tech" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tp-link-deco-dhcp/">How to disable the DHCP server on a TP-link Deco mesh network</a><li><a href="/posts/battery-change/">How to change some batteries in under 10s</a><li><a href="/posts/home-assistant-alexa-cloudflare/">Home Assistant Alexa smart home integration over Cloudflare</a><li><a href="/posts/blackmagic/">Controlling Blackmagic Design Smart Videohubs from QLab</a><li><a href="/posts/coming-back/">Restarting the blog</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/analytics/">analytics</a> <a class="post-tag" href="/tags/anecdote/">anecdote</a> <a class="post-tag" href="/tags/applescript/">applescript</a> <a class="post-tag" href="/tags/blackmagic/">blackmagic</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/communication/">communication</a> <a class="post-tag" href="/tags/deco/">deco</a> <a class="post-tag" href="/tags/dhcp/">dhcp</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tp-link-deco-dhcp/"><div class="card-body"> <em class="small" data-ts="1691017200" data-df="ll" > Aug 3, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to disable the DHCP server on a TP-link Deco mesh network</h3><div class="text-muted small"><p> How to disable the DHCP server on a TP-link Deco mesh network I recently moved house and, for the first time ever, was able to upgraded my broadband to fibre to the premises. This is great, and I n...</p></div></div></a></div><div class="card"> <a href="/posts/free-cloudflare-analytics/"><div class="card-body"> <em class="small" data-ts="1628809200" data-df="ll" > Aug 13, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting more analytics for a free Cloudflare account</h3><div class="text-muted small"><p> Ever wished that you could get more Cloudflare analytics for free? But don’t want to upgrade your Cloudflare account? So here’s a hacky way to get a little more data out of the free features that y...</p></div></div></a></div><div class="card"> <a href="/posts/battery-change/"><div class="card-body"> <em class="small" data-ts="1666652400" data-df="ll" > Oct 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to change some batteries in under 10s</h3><div class="text-muted small"><p> How to change some batteries in under 10s I know this might not seem the most impressive thing but how many people could actually change the batteries in a device they have this quickly? It definit...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/coming-back/" class="btn btn-outline-primary" prompt="Older"><p>Restarting the blog</p></a> <a href="/posts/battery-change/" class="btn btn-outline-primary" prompt="Newer"><p>How to change some batteries in under 10s</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "allaway-tech/allaway-tech.github.io-comments", "data-repo-id": "R_kgDOHfMmUA", "data-category": "Comments", "data-category-id": "DIC_kwDOHfMmUM4CPnSE", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/analytics/">analytics</a> <a class="post-tag" href="/tags/anecdote/">anecdote</a> <a class="post-tag" href="/tags/applescript/">applescript</a> <a class="post-tag" href="/tags/blackmagic/">blackmagic</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/communication/">communication</a> <a class="post-tag" href="/tags/deco/">deco</a> <a class="post-tag" href="/tags/dhcp/">dhcp</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/harmanhobbit">ian</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
